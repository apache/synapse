<synapse xmlns="http://ws.apache.org/ns/synapse">
  
  <definitions>
  	<sequence name="stockquote">
    	<log level="custom">
    		<property name="sequence" value="*** Custom 'stockquote'Sequence ***"/>
    	</log>
			<in>
	    	<header name="To" value="http://ws.invesbot.com/stockquotes.asmx"/>
    	</in>
    	<!-- set correlation field to custom label -->
    	<set-property name="correlate/label" value="stockquote"/>
      <send/>
    </sequence>
    
    <endpoint name="invesbot" address="http://ws.invesbot.com/stockquotes.asmx"/>
  </definitions>
  
  <proxies>
  	<proxy name="InvesbotSequenceProxy" type="wsdl" description="This uses the stockquote named sequence for mediation">
	    <endpoint protocol="http" uri="/MyfirstProxy"/>
	    <target sequence="stockquote"/>
	    <wsdl url="file:synapse_repository/conf/sample/sample_proxy_1.wsdl"/>
	    <policy url="file:synapse_repository/conf/sample/sample_policy_1.xml"/>
	  </proxy>
	  
	  <proxy name="InvesbotForwardProxy" type="wsdl" description="This simply forwards all messages to the investbot endpoint">
	    <endpoint protocol="http" uri="/MyfirstProxy"/>
	    <target endpoint="invesbot"/>
	    <wsdl url="file:synapse_repository/conf/sample/sample_proxy_1.wsdl"/>
	  </proxy>  	
	  
	  <proxy name="InvesbotDefaultProxy" type="wsdl" description="This simply forwards all messages to the investbot endpoint">
	    <endpoint protocol="http" uri="/MyfirstProxy"/>
	    <wsdl url="file:synapse_repository/conf/sample/sample_proxy_1.wsdl"/>
	  </proxy>

  </proxies>

  <rules>
    <out>
  		<filter source="get-property('correlate/label')" regex="stockquote">
	  		<sequence ref="stockquote"/>
	  	</filter>
	  </out>
	  	
		<log level="custom">
			<property name="sequence" value="*** Default Main mediator Sequence ***"/>
		</log>
		<in>
    	<header name="To" value="http://ws.invesbot.com/stockquotes.asmx"/>
    </in>
    <send/>
  </rules>

</synapse> 