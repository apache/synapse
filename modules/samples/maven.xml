<?xml version="1.0" encoding="UTF-8"?>
<!--
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.    
-->
<project default="jar"
         xmlns:j="jelly:core"
         xmlns:u="jelly:util"
         xmlns:deploy="deploy"
         xmlns:ant="jelly:ant"
         xmlns:maven="jelly:maven"
         xmlns:define="jelly:define">

    <j:set var="dist.name" value="${pom.artifactId}-${pom.currentVersion}"/>
    <!--<j:set var="dist.dir" value="target/dist"/>-->
    <j:set var="samples.dir" value="target/samples"/>

    <preGoal name="java:compile">
        <ant:path id="simpleStockQuoteService.src.dir" location="services/SimpleStockQuoteService/src"/>
        <maven:addPath id="maven.compile.src.set" refid="simpleStockQuoteService.src.dir"/>
    </preGoal>

    <postGoal name="test:test">
        <j:if test="${context.getVariable('maven.test.skip') != 'true'}">
            <attainGoal name="toDistBin"/>
        </j:if>
    </postGoal>

    <goal name="samples_userguide">
        <mkdir dir="target/samples"/>
        <mkdir dir="${samples.dir}/src"/>
        <ant:copy todir="${samples.dir}/src">
            <ant:fileset dir="src">
                <ant:include name="samples/**"/>
            </ant:fileset>
        </ant:copy>

    </goal>

    <goal name="toDistBin" prereqs="samples_userguide">
        <property name="bin.dist.dir" value="target/dist-bin"/>
        <ant:mkdir dir="${bin.dist.dir}"/>
        <ant:mkdir dir="${bin.dist.dir}/samples"/>
        <ant:mkdir dir="${bin.dist.dir}/samples/services"/>

        <ant:copy todir="${bin.dist.dir}/samples">
            <ant:fileset dir="scripts/userguide">
                <ant:include name="**/*"/>
            </ant:fileset>
        </ant:copy>

        <ant:copy todir="${bin.dist.dir}/samples/services">
            <ant:fileset dir="services">
                <ant:include name="**/*"/>
            </ant:fileset>
        </ant:copy>

        <ant:copy todir="${bin.dist.dir}/samples">
            <ant:fileset dir="target/samples/">
                <include name="**"/>
            </ant:fileset>
        </ant:copy>

        <ant:delete dir="target/samples"/>
    </goal>
</project>
