<definitions xmlns="http://ws.apache.org/ns/synapse">

    <!-- Introduction to the script mediator using in-line scripts -->

    <!-- define a reuseable endpoint definition and use it within config -->
    <endpoint name="stockquote">
	<address uri="http://localhost:9000/axis2/services/SimpleStockQuoteService"/>
    </endpoint>

    <in>
            <!-- transform the custom quote request into a standard quote requst expected by the service -->
            <script language="js"><![CDATA[
               var symbol = mc.getPayloadXML()..*::Code.toString();
               mc.setPayloadXML(
                  <m:getQuote xmlns:m="http://services.samples/xsd">
                     <m:request>
                        <m:symbol>{symbol}</m:symbol>
                     </m:request>
                  </m:getQuote>);
            ]]></script>

            <!-- send message to real endpoint referenced by name "stockquote" and stop -->
            <send>
                <endpoint key="stockquote"/>
            </send>
     </in>

     <out>
            <!-- transform the standard response back into the custom format the client expects -->
            <script language="js"><![CDATA[
               var symbol = mc.getPayloadXML()..*::symbol.toString();
               var price = mc.getPayloadXML()..*::last.toString();
               mc.setPayloadXML(
                  <m:CheckPriceResponse xmlns:m="http://www.apache-synapse.org/test">
               <m:Code>{symbol}</m:Code>
               <m:Price>{price}</m:Price>
                  </m:CheckPriceResponse>);
            ]]></script>

            <!-- now send the custom response back to the client and stop -->
            <send/>
     </out>
    

</definitions> 
